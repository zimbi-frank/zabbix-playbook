---

- name: check if file is there
  stat: path=/usr/share/zabbix-server-mysql/data.sql
  register: file

- name: Unzip SQL files 
  command: gzip -d {{ item }}.gz
  with_items:
    - data.sql
    - images.sql
    - schema.sql
  args:
    chdir: /usr/share/zabbix-server-mysql/
  when: not file.stat.exists

- name: Create MYsql database
  mysql_db: login_password=zabbix 
            name=zabbix 
            state=present  

- name: Create a MYsql database user
  mysql_user: login_password=zabbix 
              name=zabbix@localhost
              password=zabbix 
              priv=zabbix.*:ALL,GRANT 
              state=present

- name: Import databases
  mysql_db: state=import
            name=zabbix
            login_password=zabbix 
            target="/usr/share/zabbix-server-mysql/data.sql"

- name: Import databases1
  mysql_db: state=import
            name=zabbix
            login_password=zabbix 
            target="/usr/share/zabbix-server-mysql/images.sql"

- name: Import databases2
  mysql_db: state=import
            name=zabbix
            login_password=zabbix 
            target="/usr/share/zabbix-server-mysql/schema.sql"

